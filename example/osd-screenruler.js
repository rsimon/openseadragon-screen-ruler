(function(y,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("openseadragon")):typeof define=="function"&&define.amd?define(["exports","openseadragon"],m):(y=typeof globalThis<"u"?globalThis:y||self,m(y.OSDScreenRuler={},y.OpenSeadragon))})(this,function(y,m){"use strict";var Te=Object.defineProperty;var Be=(y,m,w)=>m in y?Te(y,m,{enumerable:!0,configurable:!0,writable:!0,value:w}):y[m]=w;var ne=(y,m,w)=>(Be(y,typeof m!="symbol"?m+"":m,w),w);function w(){}function X(e,t){for(const n in t)e[n]=t[n];return e}function se(e){return e()}function oe(){return Object.create(null)}function j(e){e.forEach(se)}function le(e){return typeof e=="function"}function Z(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function he(e){return Object.keys(e).length===0}function re(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function Y(e,t){const n={};t=new Set(t);for(const l in e)!t.has(l)&&l[0]!=="$"&&(n[l]=e[l]);return n}function F(e,t){e.appendChild(t)}function T(e,t,n){e.insertBefore(t,n||null)}function H(e){e.parentNode&&e.parentNode.removeChild(e)}function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function U(e,t,n,l){return e.addEventListener(t,n,l),()=>e.removeEventListener(t,n,l)}function u(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ge(e){return Array.from(e.childNodes)}let B;function D(e){B=e}function _e(){if(!B)throw new Error("Function called outside component initialization");return B}function me(e){_e().$$.on_mount.push(e)}function pe(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(l=>l.call(this,t))}const N=[],ie=[];let O=[];const ae=[],ye=Promise.resolve();let $=!1;function we(){$||($=!0,ye.then(fe))}function G(e){O.push(e)}const J=new Set;let R=0;function fe(){if(R!==0)return;const e=B;do{try{for(;R<N.length;){const t=N[R];R++,D(t),ve(t.$$)}}catch(t){throw N.length=0,R=0,t}for(D(null),N.length=0,R=0;ie.length;)ie.pop()();for(let t=0;t<O.length;t+=1){const n=O[t];J.has(n)||(J.add(n),n())}O.length=0}while(N.length);for(;ae.length;)ae.pop()();$=!1,J.clear(),D(e)}function ve(e){if(e.fragment!==null){e.update(),j(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(G)}}function be(e){const t=[],n=[];O.forEach(l=>e.indexOf(l)===-1?t.push(l):n.push(l)),n.forEach(l=>l()),O=t}const q=new Set;let k;function Pe(){k={r:0,c:[],p:k}}function Ee(){k.r||j(k.c),k=k.p}function z(e,t){e&&e.i&&(q.delete(e),e.i(t))}function L(e,t,n,l){if(e&&e.o){if(q.has(e))return;q.add(e),k.c.push(()=>{q.delete(e),l&&(n&&e.d(1),l())}),e.o(t)}else l&&l()}function K(e){e&&e.c()}function V(e,t,n){const{fragment:l,after_update:r}=e.$$;l&&l.m(t,n),G(()=>{const d=e.$$.on_mount.map(se).filter(le);e.$$.on_destroy?e.$$.on_destroy.push(...d):j(d),e.$$.on_mount=[]}),r.forEach(G)}function W(e,t){const n=e.$$;n.fragment!==null&&(be(n.after_update),j(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Se(e,t){e.$$.dirty[0]===-1&&(N.push(e),we(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Q(e,t,n,l,r,d,a=null,i=[-1]){const o=B;D(e);const f=e.$$={fragment:null,ctx:[],props:d,update:w,not_equal:r,bound:oe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(o?o.$$.context:[])),callbacks:oe(),dirty:i,skip_bound:!1,root:t.target||o.$$.root};a&&a(f.root);let _=!1;if(f.ctx=n?n(e,t.props||{},(c,s,...h)=>{const v=h.length?h[0]:s;return f.ctx&&r(f.ctx[c],f.ctx[c]=v)&&(!f.skip_bound&&f.bound[c]&&f.bound[c](v),_&&Se(e,c)),s}):[],f.update(),_=!0,j(f.before_update),f.fragment=l?l(f.ctx):!1,t.target){if(t.hydrate){const c=ge(t.target);f.fragment&&f.fragment.l(c),c.forEach(H)}else f.fragment&&f.fragment.c();t.intro&&z(e.$$.fragment),V(e,t.target,t.anchor),fe()}D(o)}class x{constructor(){ne(this,"$$");ne(this,"$$set")}$destroy(){W(this,1),this.$destroy=w}$on(t,n){if(!le(n))return w;const l=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return l.push(n),()=>{const r=l.indexOf(n);r!==-1&&l.splice(r,1)}}$set(t){this.$$set&&!he(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Me="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Me);const De="";function ke(e){let t,n,l,r,d,a,i;return{c(){t=E("g"),n=E("path"),r=E("path"),u(n,"d",l=`M${e[0]-e[4]} ${e[1]-1.5*e[3]} l${e[4]} ${-e[3]} l${e[4]} ${e[3]}`),u(n,"class","svelte-zrisge"),u(r,"d",d=`M${e[0]-e[4]} ${e[1]+1.5*e[3]} l${e[4]} ${e[3]} l${e[4]} ${-e[3]}`),u(r,"class","svelte-zrisge"),u(t,"class",a=e[5].class),u(t,"transform",i=`rotate(${e[2]}, ${e[0]}, ${e[1]})`)},m(o,f){T(o,t,f),F(t,n),F(t,r)},p(o,[f]){f&27&&l!==(l=`M${o[0]-o[4]} ${o[1]-1.5*o[3]} l${o[4]} ${-o[3]} l${o[4]} ${o[3]}`)&&u(n,"d",l),f&27&&d!==(d=`M${o[0]-o[4]} ${o[1]+1.5*o[3]} l${o[4]} ${o[3]} l${o[4]} ${-o[3]}`)&&u(r,"d",d),f&32&&a!==(a=o[5].class)&&u(t,"class",a),f&7&&i!==(i=`rotate(${o[2]}, ${o[0]}, ${o[1]})`)&&u(t,"transform",i)},i:w,o:w,d(o){o&&H(t)}}}function ze(e,t,n){let l,r,d;const a=["x","y","scale","slant"];let i=Y(t,a),{x:o}=t,{y:f}=t,{scale:_}=t,{slant:c}=t;return e.$$set=s=>{t=X(X({},t),re(s)),n(5,i=Y(t,a)),"x"in s&&n(0,o=s.x),"y"in s&&n(1,f=s.y),"scale"in s&&n(6,_=s.scale),"slant"in s&&n(7,c=s.slant)},e.$$.update=()=>{e.$$.dirty&64&&n(4,l=7/_),e.$$.dirty&64&&n(3,r=4/_),e.$$.dirty&128&&n(2,d=180*Math.atan(c)/Math.PI)},[o,f,d,r,l,i,_,c]}class Ce extends x{constructor(t){super(),Q(this,t,ze,ke,Z,{x:0,y:1,scale:6,slant:7})}}const Le="";function Ie(e){let t,n,l,r,d,a;return{c(){t=E("g"),n=E("circle"),l=E("circle"),u(n,"class","slant-handle-outer svelte-12mn6zh"),u(n,"cx",e[0]),u(n,"cy",e[1]),u(n,"r",e[3]),u(l,"class","slant-handle-inner svelte-12mn6zh"),u(l,"cx",e[0]),u(l,"cy",e[1]),u(l,"r",e[2]),u(t,"class",r=e[4].class)},m(i,o){T(i,t,o),F(t,n),F(t,l),d||(a=U(n,"pointerdown",e[6]),d=!0)},p(i,[o]){o&1&&u(n,"cx",i[0]),o&2&&u(n,"cy",i[1]),o&8&&u(n,"r",i[3]),o&1&&u(l,"cx",i[0]),o&2&&u(l,"cy",i[1]),o&4&&u(l,"r",i[2]),o&16&&r!==(r=i[4].class)&&u(t,"class",r)},i:w,o:w,d(i){i&&H(t),d=!1,a()}}}function je(e,t,n){let l,r;const d=["x","y","scale"];let a=Y(t,d),{x:i}=t,{y:o}=t,{scale:f}=t;function _(c){pe.call(this,e,c)}return e.$$set=c=>{t=X(X({},t),re(c)),n(4,a=Y(t,d)),"x"in c&&n(0,i=c.x),"y"in c&&n(1,o=c.y),"scale"in c&&n(5,f=c.scale)},e.$$.update=()=>{e.$$.dirty&32&&n(3,l=20/f),e.$$.dirty&32&&n(2,r=6/f)},[i,o,r,l,a,f,_]}class ue extends x{constructor(t){super(),Q(this,t,je,Ie,Z,{x:0,y:1,scale:5})}}const Xe="";function ee(e){const t=e.slice(),n=t[2]*t[1].width+t[3];return t[16]=n,t}function de(e){let t,n,l,r,d,a,i,o,f,_,c;return a=new ue({props:{class:"hideable",x:e[5].left,y:e[2]*e[5].left+e[3],scale:e[0]}}),a.$on("pointerdown",e[7]("left-slant")),i=new Ce({props:{class:"hideable",x:e[5].middle,y:e[2]*e[5].middle+e[3],scale:e[0],slant:e[2]}}),o=new ue({props:{class:"hideable",x:e[5].right,y:e[2]*e[5].right+e[3],scale:e[0]}}),o.$on("pointerdown",e[7]("right-slant")),{c(){t=E("line"),r=E("polygon"),K(a.$$.fragment),K(i.$$.fragment),K(o.$$.fragment),u(t,"class","ruler svelte-1vl8agx"),u(t,"x1",0),u(t,"y1",e[3]),u(t,"x2",n=e[1].width),u(t,"y2",l=e[16]),u(r,"class","h-pos-handle hideable svelte-1vl8agx"),u(r,"points",d=[[0,e[3]-e[6]/2],[e[1].width,e[16]-e[6]/2],[e[1].width,e[16]+e[6]/2],[0,e[3]+e[6]/2]].map(ce).join(" "))},m(s,h){T(s,t,h),T(s,r,h),V(a,s,h),V(i,s,h),V(o,s,h),f=!0,_||(c=[U(t,"pointerdown",e[7]("ruler")),U(r,"pointerdown",e[7]("ruler"))],_=!0)},p(s,h){(!f||h&8)&&u(t,"y1",s[3]),(!f||h&2&&n!==(n=s[1].width))&&u(t,"x2",n),(!f||h&14&&l!==(l=s[16]))&&u(t,"y2",l),(!f||h&78&&d!==(d=[[0,s[3]-s[6]/2],[s[1].width,s[16]-s[6]/2],[s[1].width,s[16]+s[6]/2],[0,s[3]+s[6]/2]].map(ce).join(" ")))&&u(r,"points",d);const v={};h&32&&(v.x=s[5].left),h&44&&(v.y=s[2]*s[5].left+s[3]),h&1&&(v.scale=s[0]),a.$set(v);const C={};h&32&&(C.x=s[5].middle),h&44&&(C.y=s[2]*s[5].middle+s[3]),h&1&&(C.scale=s[0]),h&4&&(C.slant=s[2]),i.$set(C);const A={};h&32&&(A.x=s[5].right),h&44&&(A.y=s[2]*s[5].right+s[3]),h&1&&(A.scale=s[0]),o.$set(A)},i(s){f||(z(a.$$.fragment,s),z(i.$$.fragment,s),z(o.$$.fragment,s),f=!0)},o(s){L(a.$$.fragment,s),L(i.$$.fragment,s),L(o.$$.fragment,s),f=!1},d(s){s&&(H(t),H(r)),W(a,s),W(i,s),W(o,s),_=!1,j(c)}}}function He(e){let t,n,l,r,d,a=e[1]&&de(ee(e));return{c(){t=E("svg"),n=E("g"),a&&a.c(),u(n,"class","osd-screenruler svelte-1vl8agx"),u(n,"transform",e[4]),u(t,"class","svelte-1vl8agx")},m(i,o){T(i,t,o),F(t,n),a&&a.m(n,null),l=!0,r||(d=U(n,"pointermove",e[8]),r=!0)},p(i,[o]){i[1]?a?(a.p(ee(i),o),o&2&&z(a,1)):(a=de(ee(i)),a.c(),z(a,1),a.m(n,null)):a&&(Pe(),L(a,1,1,()=>{a=null}),Ee()),(!l||o&16)&&u(n,"transform",i[4])},i(i){l||(z(a),l=!0)},o(i){L(a),l=!1},d(i){i&&H(t),a&&a.d(),r=!1,d()}}}const ce=e=>e.join(",");function Ne(e,t,n){let l,{viewer:r}=t,{handlePadding:d=8}=t,a,i,o,f=1,_,c,s;const h=()=>{var p,b;const g=(b=(p=r.world.getItemAt(0))==null?void 0:p.source)==null?void 0:b.dimensions;g&&(n(1,a={width:g.x,height:g.y}),n(2,i=0),n(3,o=g.y/2),v())},v=()=>{const g=r.viewport.getContainerSize().x,p=r.viewport.getZoom(!0),b=r.viewport.getFlip(),M=r.viewport.pixelFromPoint(new m.Point(0,0),!0);b&&(M.x=g-M.x);const P=p*g/r.world.getContentFactor(),S=b?-P:P,I=r.viewport.getRotation(!0);n(4,_=`translate(${M.x}, ${M.y}) scale(${S}, ${P}) rotate(${I})`),n(0,f=p*g/r.world.getContentFactor()),C()},C=()=>{const{viewport:g}=r,p=g.viewportToImageRectangle(g.getBounds(!0)),{x:b,width:M}=p,P=Math.max(0,b+d/f),S=Math.min(a.width,b+M-d/f),I=P+(S-P)/2;n(5,s={left:P,middle:I,right:S})},A=g=>p=>{if(p.button!==0)return;c=g,p.target.setPointerCapture(p.pointerId),r.setMouseNavEnabled(!1)},Ae=g=>{if(!c)return;const{offsetX:p,offsetY:b}=g,{x:M,y:P}=r.viewport.viewerElementToImageCoordinates(new m.Point(p,b));if(c==="ruler")n(3,o=P-i*M);else if(c==="left-slant"){const S=i*s.right+o,I=s.right-s.left,te=P-S;n(2,i=-te/I),n(3,o=S-i*s.right)}else if(c==="right-slant"){const S=i*s.left+o,I=s.right-s.left,te=S-P;n(2,i=-te/I),n(3,o=S-i*s.left)}},Fe=g=>{c=void 0,g.target.releasePointerCapture(g.pointerId),r.setMouseNavEnabled(!0)};return me(()=>(document.addEventListener("pointerup",Fe),r.addHandler("open",h),r.addHandler("update-viewport",v),h(),()=>{r.removeHandler("page",h),r.removeHandler("update-viewport",v)})),e.$$set=g=>{"viewer"in g&&n(9,r=g.viewer),"handlePadding"in g&&n(10,d=g.handlePadding)},e.$$.update=()=>{e.$$.dirty&1&&n(6,l=8/f)},[f,a,i,o,_,s,l,A,Ae,r,d]}class Oe extends x{constructor(t){super(),Q(this,t,Ne,He,Z,{viewer:9,handlePadding:10})}}const Re=e=>{new Oe({target:e.element.querySelector(".openseadragon-canvas"),props:{viewer:e}})};y.init=Re,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=osd-screenruler.js.map
