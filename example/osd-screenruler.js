(function(y,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("openseadragon")):typeof define=="function"&&define.amd?define(["exports","openseadragon"],m):(y=typeof globalThis<"u"?globalThis:y||self,m(y.OSDScreenRuler={},y.OpenSeadragon))})(this,function(y,m){"use strict";var Te=Object.defineProperty;var Be=(y,m,w)=>m in y?Te(y,m,{enumerable:!0,configurable:!0,writable:!0,value:w}):y[m]=w;var te=(y,m,w)=>(Be(y,typeof m!="symbol"?m+"":m,w),w);function w(){}function X(e,n){for(const t in n)e[t]=n[t];return e}function se(e){return e()}function oe(){return Object.create(null)}function j(e){e.forEach(se)}function le(e){return typeof e=="function"}function Z(e,n){return e!=e?n==n:e!==n||e&&typeof e=="object"||typeof e=="function"}function he(e){return Object.keys(e).length===0}function re(e){const n={};for(const t in e)t[0]!=="$"&&(n[t]=e[t]);return n}function Y(e,n){const t={};n=new Set(n);for(const l in e)!n.has(l)&&l[0]!=="$"&&(t[l]=e[l]);return t}function F(e,n){e.appendChild(n)}function T(e,n,t){e.insertBefore(n,t||null)}function H(e){e.parentNode&&e.parentNode.removeChild(e)}function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function U(e,n,t,l){return e.addEventListener(n,t,l),()=>e.removeEventListener(n,t,l)}function u(e,n,t){t==null?e.removeAttribute(n):e.getAttribute(n)!==t&&e.setAttribute(n,t)}function ge(e){return Array.from(e.childNodes)}let B;function D(e){B=e}function _e(){if(!B)throw new Error("Function called outside component initialization");return B}function me(e){_e().$$.on_mount.push(e)}function pe(e,n){const t=e.$$.callbacks[n.type];t&&t.slice().forEach(l=>l.call(this,n))}const N=[],ie=[];let O=[];const fe=[],ye=Promise.resolve();let $=!1;function we(){$||($=!0,ye.then(ae))}function G(e){O.push(e)}const J=new Set;let R=0;function ae(){if(R!==0)return;const e=B;do{try{for(;R<N.length;){const n=N[R];R++,D(n),ve(n.$$)}}catch(n){throw N.length=0,R=0,n}for(D(null),N.length=0,R=0;ie.length;)ie.pop()();for(let n=0;n<O.length;n+=1){const t=O[n];J.has(t)||(J.add(t),t())}O.length=0}while(N.length);for(;fe.length;)fe.pop()();$=!1,J.clear(),D(e)}function ve(e){if(e.fragment!==null){e.update(),j(e.before_update);const n=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,n),e.after_update.forEach(G)}}function be(e){const n=[],t=[];O.forEach(l=>e.indexOf(l)===-1?n.push(l):t.push(l)),t.forEach(l=>l()),O=n}const q=new Set;let k;function Pe(){k={r:0,c:[],p:k}}function Ee(){k.r||j(k.c),k=k.p}function z(e,n){e&&e.i&&(q.delete(e),e.i(n))}function L(e,n,t,l){if(e&&e.o){if(q.has(e))return;q.add(e),k.c.push(()=>{q.delete(e),l&&(t&&e.d(1),l())}),e.o(n)}else l&&l()}function K(e){e&&e.c()}function V(e,n,t){const{fragment:l,after_update:r}=e.$$;l&&l.m(n,t),G(()=>{const d=e.$$.on_mount.map(se).filter(le);e.$$.on_destroy?e.$$.on_destroy.push(...d):j(d),e.$$.on_mount=[]}),r.forEach(G)}function W(e,n){const t=e.$$;t.fragment!==null&&(be(t.after_update),j(t.on_destroy),t.fragment&&t.fragment.d(n),t.on_destroy=t.fragment=null,t.ctx=[])}function Se(e,n){e.$$.dirty[0]===-1&&(N.push(e),we(),e.$$.dirty.fill(0)),e.$$.dirty[n/31|0]|=1<<n%31}function Q(e,n,t,l,r,d,f=null,i=[-1]){const o=B;D(e);const a=e.$$={fragment:null,ctx:[],props:d,update:w,not_equal:r,bound:oe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(o?o.$$.context:[])),callbacks:oe(),dirty:i,skip_bound:!1,root:n.target||o.$$.root};f&&f(a.root);let _=!1;if(a.ctx=t?t(e,n.props||{},(c,s,...h)=>{const v=h.length?h[0]:s;return a.ctx&&r(a.ctx[c],a.ctx[c]=v)&&(!a.skip_bound&&a.bound[c]&&a.bound[c](v),_&&Se(e,c)),s}):[],a.update(),_=!0,j(a.before_update),a.fragment=l?l(a.ctx):!1,n.target){if(n.hydrate){const c=ge(n.target);a.fragment&&a.fragment.l(c),c.forEach(H)}else a.fragment&&a.fragment.c();n.intro&&z(e.$$.fragment),V(e,n.target,n.anchor),ae()}D(o)}class x{constructor(){te(this,"$$");te(this,"$$set")}$destroy(){W(this,1),this.$destroy=w}$on(n,t){if(!le(t))return w;const l=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return l.push(t),()=>{const r=l.indexOf(t);r!==-1&&l.splice(r,1)}}$set(n){this.$$set&&!he(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const Me="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Me);const De="";function ke(e){let n,t,l,r,d,f,i;return{c(){n=E("g"),t=E("path"),r=E("path"),u(t,"d",l=`M${e[0]-e[4]} ${e[1]-1.5*e[3]} l${e[4]} ${-e[3]} l${e[4]} ${e[3]}`),u(t,"class","svelte-zrisge"),u(r,"d",d=`M${e[0]-e[4]} ${e[1]+1.5*e[3]} l${e[4]} ${e[3]} l${e[4]} ${-e[3]}`),u(r,"class","svelte-zrisge"),u(n,"class",f=e[5].class),u(n,"transform",i=`rotate(${e[2]}, ${e[0]}, ${e[1]})`)},m(o,a){T(o,n,a),F(n,t),F(n,r)},p(o,[a]){a&27&&l!==(l=`M${o[0]-o[4]} ${o[1]-1.5*o[3]} l${o[4]} ${-o[3]} l${o[4]} ${o[3]}`)&&u(t,"d",l),a&27&&d!==(d=`M${o[0]-o[4]} ${o[1]+1.5*o[3]} l${o[4]} ${o[3]} l${o[4]} ${-o[3]}`)&&u(r,"d",d),a&32&&f!==(f=o[5].class)&&u(n,"class",f),a&7&&i!==(i=`rotate(${o[2]}, ${o[0]}, ${o[1]})`)&&u(n,"transform",i)},i:w,o:w,d(o){o&&H(n)}}}function ze(e,n,t){let l,r,d;const f=["x","y","scale","slant"];let i=Y(n,f),{x:o}=n,{y:a}=n,{scale:_}=n,{slant:c}=n;return e.$$set=s=>{n=X(X({},n),re(s)),t(5,i=Y(n,f)),"x"in s&&t(0,o=s.x),"y"in s&&t(1,a=s.y),"scale"in s&&t(6,_=s.scale),"slant"in s&&t(7,c=s.slant)},e.$$.update=()=>{e.$$.dirty&64&&t(4,l=7/_),e.$$.dirty&64&&t(3,r=4/_),e.$$.dirty&128&&t(2,d=180*Math.atan(c)/Math.PI)},[o,a,d,r,l,i,_,c]}class Ce extends x{constructor(n){super(),Q(this,n,ze,ke,Z,{x:0,y:1,scale:6,slant:7})}}const Le="";function Ie(e){let n,t,l,r,d,f;return{c(){n=E("g"),t=E("circle"),l=E("circle"),u(t,"class","slant-handle-outer svelte-12mn6zh"),u(t,"cx",e[0]),u(t,"cy",e[1]),u(t,"r",e[3]),u(l,"class","slant-handle-inner svelte-12mn6zh"),u(l,"cx",e[0]),u(l,"cy",e[1]),u(l,"r",e[2]),u(n,"class",r=e[4].class)},m(i,o){T(i,n,o),F(n,t),F(n,l),d||(f=U(t,"pointerdown",e[6]),d=!0)},p(i,[o]){o&1&&u(t,"cx",i[0]),o&2&&u(t,"cy",i[1]),o&8&&u(t,"r",i[3]),o&1&&u(l,"cx",i[0]),o&2&&u(l,"cy",i[1]),o&4&&u(l,"r",i[2]),o&16&&r!==(r=i[4].class)&&u(n,"class",r)},i:w,o:w,d(i){i&&H(n),d=!1,f()}}}function je(e,n,t){let l,r;const d=["x","y","scale"];let f=Y(n,d),{x:i}=n,{y:o}=n,{scale:a}=n;function _(c){pe.call(this,e,c)}return e.$$set=c=>{n=X(X({},n),re(c)),t(4,f=Y(n,d)),"x"in c&&t(0,i=c.x),"y"in c&&t(1,o=c.y),"scale"in c&&t(5,a=c.scale)},e.$$.update=()=>{e.$$.dirty&32&&t(3,l=20/a),e.$$.dirty&32&&t(2,r=6/a)},[i,o,r,l,f,a,_]}class ue extends x{constructor(n){super(),Q(this,n,je,Ie,Z,{x:0,y:1,scale:5})}}const Xe="";function ee(e){const n=e.slice(),t=n[2]*n[1].width+n[3];return n[16]=t,n}function de(e){let n,t,l,r,d,f,i,o,a,_,c;return f=new ue({props:{class:"hideable",x:e[5].left,y:e[2]*e[5].left+e[3],scale:e[0]}}),f.$on("pointerdown",e[7]("left-slant")),i=new Ce({props:{class:"hideable",x:e[5].middle,y:e[2]*e[5].middle+e[3],scale:e[0],slant:e[2]}}),o=new ue({props:{class:"hideable",x:e[5].right,y:e[2]*e[5].right+e[3],scale:e[0]}}),o.$on("pointerdown",e[7]("right-slant")),{c(){n=E("line"),r=E("polygon"),K(f.$$.fragment),K(i.$$.fragment),K(o.$$.fragment),u(n,"class","ruler svelte-19nmfhl"),u(n,"x1",0),u(n,"y1",e[3]),u(n,"x2",t=e[1].width),u(n,"y2",l=e[16]),u(r,"class","h-pos-handle hideable svelte-19nmfhl"),u(r,"points",d=[[0,e[3]-e[6]/2],[e[1].width,e[16]-e[6]/2],[e[1].width,e[16]+e[6]/2],[0,e[3]+e[6]/2]].map(ce).join(" "))},m(s,h){T(s,n,h),T(s,r,h),V(f,s,h),V(i,s,h),V(o,s,h),a=!0,_||(c=[U(n,"pointerdown",e[7]("ruler")),U(r,"pointerdown",e[7]("ruler"))],_=!0)},p(s,h){(!a||h&8)&&u(n,"y1",s[3]),(!a||h&2&&t!==(t=s[1].width))&&u(n,"x2",t),(!a||h&14&&l!==(l=s[16]))&&u(n,"y2",l),(!a||h&78&&d!==(d=[[0,s[3]-s[6]/2],[s[1].width,s[16]-s[6]/2],[s[1].width,s[16]+s[6]/2],[0,s[3]+s[6]/2]].map(ce).join(" ")))&&u(r,"points",d);const v={};h&32&&(v.x=s[5].left),h&44&&(v.y=s[2]*s[5].left+s[3]),h&1&&(v.scale=s[0]),f.$set(v);const C={};h&32&&(C.x=s[5].middle),h&44&&(C.y=s[2]*s[5].middle+s[3]),h&1&&(C.scale=s[0]),h&4&&(C.slant=s[2]),i.$set(C);const A={};h&32&&(A.x=s[5].right),h&44&&(A.y=s[2]*s[5].right+s[3]),h&1&&(A.scale=s[0]),o.$set(A)},i(s){a||(z(f.$$.fragment,s),z(i.$$.fragment,s),z(o.$$.fragment,s),a=!0)},o(s){L(f.$$.fragment,s),L(i.$$.fragment,s),L(o.$$.fragment,s),a=!1},d(s){s&&(H(n),H(r)),W(f,s),W(i,s),W(o,s),_=!1,j(c)}}}function He(e){let n,t,l,r,d,f=e[1]&&de(ee(e));return{c(){n=E("svg"),t=E("g"),f&&f.c(),u(t,"class","osd-screenruler svelte-19nmfhl"),u(t,"transform",e[4]),u(n,"class","svelte-19nmfhl")},m(i,o){T(i,n,o),F(n,t),f&&f.m(t,null),l=!0,r||(d=U(t,"pointermove",e[8]),r=!0)},p(i,[o]){i[1]?f?(f.p(ee(i),o),o&2&&z(f,1)):(f=de(ee(i)),f.c(),z(f,1),f.m(t,null)):f&&(Pe(),L(f,1,1,()=>{f=null}),Ee()),(!l||o&16)&&u(t,"transform",i[4])},i(i){l||(z(f),l=!0)},o(i){L(f),l=!1},d(i){i&&H(n),f&&f.d(),r=!1,d()}}}const ce=e=>e.join(",");function Ne(e,n,t){let l,{viewer:r}=n,{handlePadding:d=8}=n,f,i,o,a=1,_,c,s;const h=()=>{var p,b;const g=(b=(p=r.world.getItemAt(0))==null?void 0:p.source)==null?void 0:b.dimensions;g&&(t(1,f={width:g.x,height:g.y}),t(2,i=0),t(3,o=g.y/2),v())},v=()=>{const g=r.viewport.getContainerSize().x,p=r.viewport.getZoom(!0),b=r.viewport.getFlip(),M=r.viewport.pixelFromPoint(new m.Point(0,0),!0);b&&(M.x=g-M.x);const P=p*g/r.world.getContentFactor(),S=b?-P:P,I=r.viewport.getRotation(!0);t(4,_=`translate(${M.x}, ${M.y}) scale(${S}, ${P}) rotate(${I})`),t(0,a=p*g/r.world.getContentFactor()),C()},C=()=>{const{viewport:g}=r,p=g.viewportToImageRectangle(g.getBounds(!0)),{x:b,width:M}=p,P=Math.max(0,b+d/a),S=Math.min(f.width,b+M-d/a),I=P+(S-P)/2;t(5,s={left:P,middle:I,right:S})},A=g=>p=>{if(p.button!==0)return;c=g,p.target.setPointerCapture(p.pointerId),r.setMouseNavEnabled(!1)},Ae=g=>{if(!c)return;const{offsetX:p,offsetY:b}=g,{x:M,y:P}=r.viewport.viewerElementToImageCoordinates(new m.Point(p,b));if(c==="ruler")t(3,o=P-i*M);else if(c==="left-slant"){const S=i*s.right+o,I=s.right-s.left,ne=P-S;t(2,i=-ne/I),t(3,o=S-i*s.right)}else if(c==="right-slant"){const S=i*s.left+o,I=s.right-s.left,ne=S-P;t(2,i=-ne/I),t(3,o=S-i*s.left)}},Fe=g=>{c=void 0,g.target.releasePointerCapture(g.pointerId),r.setMouseNavEnabled(!0)};return me(()=>(document.addEventListener("pointerup",Fe),r.addHandler("open",h),r.addHandler("update-viewport",v),h(),()=>{r.removeHandler("page",h),r.removeHandler("update-viewport",v)})),e.$$set=g=>{"viewer"in g&&t(9,r=g.viewer),"handlePadding"in g&&t(10,d=g.handlePadding)},e.$$.update=()=>{e.$$.dirty&1&&t(6,l=8/a)},[a,f,i,o,_,s,l,A,Ae,r,d]}class Oe extends x{constructor(n){super(),Q(this,n,Ne,He,Z,{viewer:9,handlePadding:10})}}const Re=e=>{new Oe({target:e.element.querySelector(".openseadragon-canvas"),props:{viewer:e}})};y.init=Re,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=osd-screenruler.js.map
