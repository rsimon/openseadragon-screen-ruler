(function(w,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("openseadragon")):typeof define=="function"&&define.amd?define(["exports","openseadragon"],m):(w=typeof globalThis<"u"?globalThis:w||self,m(w.OSDScreenRuler={},w.OpenSeadragon))})(this,function(w,m){"use strict";var Te=Object.defineProperty;var Ae=(w,m,y)=>m in w?Te(w,m,{enumerable:!0,configurable:!0,writable:!0,value:y}):w[m]=y;var ee=(w,m,y)=>(Ae(w,typeof m!="symbol"?m+"":m,y),y);function y(){}function ne(e){return e()}function te(){return Object.create(null)}function H(e){e.forEach(ne)}function oe(e){return typeof e=="function"}function U(e,n){return e!=e?n==n:e!==n||e&&typeof e=="object"||typeof e=="function"}function ue(e){return Object.keys(e).length===0}function q(e,n){e.appendChild(n)}function k(e,n,t){e.insertBefore(n,t||null)}function S(e){e.parentNode&&e.parentNode.removeChild(e)}function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function de(e){return document.createTextNode(e)}function ce(){return de(" ")}function D(e,n,t,i){return e.addEventListener(n,t,i),()=>e.removeEventListener(n,t,i)}function u(e,n,t){t==null?e.removeAttribute(n):e.getAttribute(n)!==t&&e.setAttribute(n,t)}function he(e){return Array.from(e.childNodes)}let A;function F(e){A=e}function ge(){if(!A)throw new Error("Function called outside component initialization");return A}function _e(e){ge().$$.on_mount.push(e)}function me(e,n){const t=e.$$.callbacks[n.type];t&&t.slice().forEach(i=>i.call(this,n))}const N=[],re=[];let O=[];const ie=[],pe=Promise.resolve();let V=!1;function we(){V||(V=!0,pe.then(se))}function W(e){O.push(e)}const Z=new Set;let R=0;function se(){if(R!==0)return;const e=A;do{try{for(;R<N.length;){const n=N[R];R++,F(n),ye(n.$$)}}catch(n){throw N.length=0,R=0,n}for(F(null),N.length=0,R=0;re.length;)re.pop()();for(let n=0;n<O.length;n+=1){const t=O[n];Z.has(t)||(Z.add(t),t())}O.length=0}while(N.length);for(;ie.length;)ie.pop()();V=!1,Z.clear(),F(e)}function ye(e){if(e.fragment!==null){e.update(),H(e.before_update);const n=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,n),e.after_update.forEach(W)}}function ve(e){const n=[],t=[];O.forEach(i=>e.indexOf(i)===-1?n.push(i):t.push(i)),t.forEach(i=>i()),O=n}const L=new Set;let z;function be(){z={r:0,c:[],p:z}}function $e(){z.r||H(z.c),z=z.p}function C(e,n){e&&e.i&&(L.delete(e),e.i(n))}function B(e,n,t,i){if(e&&e.o){if(L.has(e))return;L.add(e),z.c.push(()=>{L.delete(e),i&&(t&&e.d(1),i())}),e.o(n)}else i&&i()}function G(e){e&&e.c()}function X(e,n,t){const{fragment:i,after_update:l}=e.$$;i&&i.m(n,t),W(()=>{const d=e.$$.on_mount.map(ne).filter(oe);e.$$.on_destroy?e.$$.on_destroy.push(...d):H(d),e.$$.on_mount=[]}),l.forEach(W)}function Y(e,n){const t=e.$$;t.fragment!==null&&(ve(t.after_update),H(t.on_destroy),t.fragment&&t.fragment.d(n),t.on_destroy=t.fragment=null,t.ctx=[])}function Pe(e,n){e.$$.dirty[0]===-1&&(N.push(e),we(),e.$$.dirty.fill(0)),e.$$.dirty[n/31|0]|=1<<n%31}function J(e,n,t,i,l,d,s=null,o=[-1]){const a=A;F(e);const f=e.$$={fragment:null,ctx:[],props:d,update:y,not_equal:l,bound:te(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(a?a.$$.context:[])),callbacks:te(),dirty:o,skip_bound:!1,root:n.target||a.$$.root};s&&s(f.root);let g=!1;if(f.ctx=t?t(e,n.props||{},(_,r,...c)=>{const v=c.length?c[0]:r;return f.ctx&&l(f.ctx[_],f.ctx[_]=v)&&(!f.skip_bound&&f.bound[_]&&f.bound[_](v),g&&Pe(e,_)),r}):[],f.update(),g=!0,H(f.before_update),f.fragment=i?i(f.ctx):!1,n.target){if(n.hydrate){const _=he(n.target);f.fragment&&f.fragment.l(_),_.forEach(S)}else f.fragment&&f.fragment.c();n.intro&&C(e.$$.fragment),X(e,n.target,n.anchor),se()}F(a)}class K{constructor(){ee(this,"$$");ee(this,"$$set")}$destroy(){Y(this,1),this.$destroy=y}$on(n,t){if(!oe(t))return y;const i=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(n){this.$$set&&!ue(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const Ee="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ee);const Fe="";function Se(e){let n,t,i,l,d,s;return{c(){n=E("g"),t=E("path"),l=E("path"),u(t,"d",i=`M${e[0]-e[4]} ${e[1]-1.5*e[3]} l${e[4]} ${-e[3]} l${e[4]} ${e[3]}`),u(t,"class","svelte-zrisge"),u(l,"d",d=`M${e[0]-e[4]} ${e[1]+1.5*e[3]} l${e[4]} ${e[3]} l${e[4]} ${-e[3]}`),u(l,"class","svelte-zrisge"),u(n,"transform",s=`rotate(${e[2]}, ${e[0]}, ${e[1]})`)},m(o,a){k(o,n,a),q(n,t),q(n,l)},p(o,[a]){a&27&&i!==(i=`M${o[0]-o[4]} ${o[1]-1.5*o[3]} l${o[4]} ${-o[3]} l${o[4]} ${o[3]}`)&&u(t,"d",i),a&27&&d!==(d=`M${o[0]-o[4]} ${o[1]+1.5*o[3]} l${o[4]} ${o[3]} l${o[4]} ${-o[3]}`)&&u(l,"d",d),a&7&&s!==(s=`rotate(${o[2]}, ${o[0]}, ${o[1]})`)&&u(n,"transform",s)},i:y,o:y,d(o){o&&S(n)}}}function Me(e,n,t){let i,l,d,{x:s}=n,{y:o}=n,{scale:a}=n,{slant:f}=n;return e.$$set=g=>{"x"in g&&t(0,s=g.x),"y"in g&&t(1,o=g.y),"scale"in g&&t(5,a=g.scale),"slant"in g&&t(6,f=g.slant)},e.$$.update=()=>{e.$$.dirty&32&&t(4,i=7/a),e.$$.dirty&32&&t(3,l=4/a),e.$$.dirty&64&&t(2,d=180*Math.atan(f)/Math.PI)},[s,o,d,l,i,a,f]}class ke extends K{constructor(n){super(),J(this,n,Me,Se,U,{x:0,y:1,scale:5,slant:6})}}const Be="";function ze(e){let n,t,i,l,d;return{c(){n=E("circle"),t=ce(),i=E("circle"),u(n,"class","slant-handle-outer svelte-12mn6zh"),u(n,"cx",e[0]),u(n,"cy",e[1]),u(n,"r",e[3]),u(i,"class","slant-handle-inner svelte-12mn6zh"),u(i,"cx",e[0]),u(i,"cy",e[1]),u(i,"r",e[2])},m(s,o){k(s,n,o),k(s,t,o),k(s,i,o),l||(d=D(n,"pointerdown",e[5]),l=!0)},p(s,[o]){o&1&&u(n,"cx",s[0]),o&2&&u(n,"cy",s[1]),o&8&&u(n,"r",s[3]),o&1&&u(i,"cx",s[0]),o&2&&u(i,"cy",s[1]),o&4&&u(i,"r",s[2])},i:y,o:y,d(s){s&&(S(n),S(t),S(i)),l=!1,d()}}}function Ce(e,n,t){let i,l,{x:d}=n,{y:s}=n,{scale:o}=n;function a(f){me.call(this,e,f)}return e.$$set=f=>{"x"in f&&t(0,d=f.x),"y"in f&&t(1,s=f.y),"scale"in f&&t(4,o=f.scale)},e.$$.update=()=>{e.$$.dirty&16&&t(3,i=20/o),e.$$.dirty&16&&t(2,l=6/o)},[d,s,l,i,o,a]}class le extends K{constructor(n){super(),J(this,n,Ce,ze,U,{x:0,y:1,scale:4})}}const De="";function Q(e){const n=e.slice(),t=n[2]*n[1].width+n[3];return n[16]=t,n}function fe(e){let n,t,i,l,d,s,o,a,f,g,_;return s=new le({props:{x:e[5].left,y:e[2]*e[5].left+e[3],scale:e[0]}}),s.$on("pointerdown",e[7]("left-slant")),o=new ke({props:{x:e[5].middle,y:e[2]*e[5].middle+e[3],scale:e[0],slant:e[2]}}),a=new le({props:{x:e[5].right,y:e[2]*e[5].right+e[3],scale:e[0]}}),a.$on("pointerdown",e[7]("right-slant")),{c(){n=E("line"),l=E("polygon"),G(s.$$.fragment),G(o.$$.fragment),G(a.$$.fragment),u(n,"class","ruler svelte-mvk329"),u(n,"x1",0),u(n,"y1",e[3]),u(n,"x2",t=e[1].width),u(n,"y2",i=e[16]),u(l,"class","h-pos-handle svelte-mvk329"),u(l,"points",d=[[0,e[3]-e[6]/2],[e[1].width,e[16]-e[6]/2],[e[1].width,e[16]+e[6]/2],[0,e[3]+e[6]/2]].map(ae).join(" "))},m(r,c){k(r,n,c),k(r,l,c),X(s,r,c),X(o,r,c),X(a,r,c),f=!0,g||(_=[D(n,"pointerdown",e[7]("ruler")),D(l,"pointerdown",e[7]("ruler"))],g=!0)},p(r,c){(!f||c&8)&&u(n,"y1",r[3]),(!f||c&2&&t!==(t=r[1].width))&&u(n,"x2",t),(!f||c&14&&i!==(i=r[16]))&&u(n,"y2",i),(!f||c&78&&d!==(d=[[0,r[3]-r[6]/2],[r[1].width,r[16]-r[6]/2],[r[1].width,r[16]+r[6]/2],[0,r[3]+r[6]/2]].map(ae).join(" ")))&&u(l,"points",d);const v={};c&32&&(v.x=r[5].left),c&44&&(v.y=r[2]*r[5].left+r[3]),c&1&&(v.scale=r[0]),s.$set(v);const I={};c&32&&(I.x=r[5].middle),c&44&&(I.y=r[2]*r[5].middle+r[3]),c&1&&(I.scale=r[0]),c&4&&(I.slant=r[2]),o.$set(I);const T={};c&32&&(T.x=r[5].right),c&44&&(T.y=r[2]*r[5].right+r[3]),c&1&&(T.scale=r[0]),a.$set(T)},i(r){f||(C(s.$$.fragment,r),C(o.$$.fragment,r),C(a.$$.fragment,r),f=!0)},o(r){B(s.$$.fragment,r),B(o.$$.fragment,r),B(a.$$.fragment,r),f=!1},d(r){r&&(S(n),S(l)),Y(s,r),Y(o,r),Y(a,r),g=!1,H(_)}}}function Ie(e){let n,t,i,l,d,s=e[1]&&fe(Q(e));return{c(){n=E("svg"),t=E("g"),s&&s.c(),u(t,"transform",e[4]),u(n,"class","osd-screenruler svelte-mvk329")},m(o,a){k(o,n,a),q(n,t),s&&s.m(t,null),i=!0,l||(d=D(t,"pointermove",e[8]),l=!0)},p(o,[a]){o[1]?s?(s.p(Q(o),a),a&2&&C(s,1)):(s=fe(Q(o)),s.c(),C(s,1),s.m(t,null)):s&&(be(),B(s,1,1,()=>{s=null}),$e()),(!i||a&16)&&u(t,"transform",o[4])},i(o){i||(C(s),i=!0)},o(o){B(s),i=!1},d(o){o&&S(n),s&&s.d(),l=!1,d()}}}const ae=e=>e.join(",");function je(e,n,t){let i,{viewer:l}=n,{handlePadding:d=8}=n,s,o,a,f=1,g,_,r;const c=()=>{var p,b;const h=(b=(p=l.world.getItemAt(0))==null?void 0:p.source)==null?void 0:b.dimensions;h&&(t(1,s={width:h.x,height:h.y}),t(2,o=0),t(3,a=h.y/2),v())},v=()=>{const h=l.viewport.getContainerSize().x,p=l.viewport.getZoom(!0),b=l.viewport.getFlip(),M=l.viewport.pixelFromPoint(new m.Point(0,0),!0);b&&(M.x=h-M.x);const $=p*h/l.world.getContentFactor(),P=b?-$:$,j=l.viewport.getRotation(!0);t(4,g=`translate(${M.x}, ${M.y}) scale(${P}, ${$}) rotate(${j})`),t(0,f=p*h/l.world.getContentFactor()),I()},I=()=>{const{viewport:h}=l,p=h.viewportToImageRectangle(h.getBounds(!0)),{x:b,width:M}=p,$=Math.max(0,b+d/f),P=Math.min(s.width,b+M-d/f),j=$+(P-$)/2;t(5,r={left:$,middle:j,right:P})},T=h=>p=>{if(p.button!==0)return;_=h,p.target.setPointerCapture(p.pointerId),l.setMouseNavEnabled(!1)},Oe=h=>{if(!_)return;const{offsetX:p,offsetY:b}=h,{x:M,y:$}=l.viewport.viewerElementToImageCoordinates(new m.Point(p,b));if(_==="ruler")t(3,a=$-o*M);else if(_==="left-slant"){const P=o*r.right+a,j=r.right-r.left,x=$-P;t(2,o=-x/j),t(3,a=P-o*r.right)}else if(_==="right-slant"){const P=o*r.left+a,j=r.right-r.left,x=P-$;t(2,o=-x/j),t(3,a=P-o*r.left)}},Re=h=>{_=void 0,h.target.releasePointerCapture(h.pointerId),l.setMouseNavEnabled(!0)};return _e(()=>(document.addEventListener("pointerup",Re),l.addHandler("open",c),l.addHandler("update-viewport",v),c(),()=>{l.removeHandler("page",c),l.removeHandler("update-viewport",v)})),e.$$set=h=>{"viewer"in h&&t(9,l=h.viewer),"handlePadding"in h&&t(10,d=h.handlePadding)},e.$$.update=()=>{e.$$.dirty&1&&t(6,i=8/f)},[f,s,o,a,g,r,i,T,Oe,l,d]}class He extends K{constructor(n){super(),J(this,n,je,Ie,U,{viewer:9,handlePadding:10})}}const Ne=e=>{new He({target:e.element.querySelector(".openseadragon-canvas"),props:{viewer:e}})};w.init=Ne,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=osd-screenruler.js.map
